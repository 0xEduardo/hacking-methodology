# CSRF

## Conditions to exploit an useful CSRF

1. Revelant action (CSRF in logout is a boo)
2. Cookie based session (if JWT you are done here)
3. No unpredictable request parameters

## How to find

- Remove CSRF token from request, replace with random value or blank space
- Change POST to GET
- Replace CSRF token with an already used token
- Bypass regex
- Get a token by request and call manually
- Extract the token with XSS or HTML injection

# Articles

|URL|Description|
|---|---|
|[What is CRSF](https://kernelpanic.cryptid.fr/en/blog/nonsense-mayhem-samesite-cors-and-csrf)|Part #1|
|[Why CORS makes CSRf impossible](https://kernelpanic.cryptid.fr/en/blog/nonsense-mayhem-samesite-cors-and-csrf-part-2)|Part #2|

## Generate POCs

- In burp, click in request > engagement tools > generate CSRF poc

|URL|Description|
|---|---|
|[https://pentestbook.six2dez.com/enumeration/web/csrf](https://pentestbook.six2dez.com/enumeration/web/csrf)|CSRF POCs|

## Mindmap

![[Pasted image 20241106102337.png]]
## Common CSRF Defenses

#### CSRF Tokens

- unpredictable random value
- submitted in HTML form
- needs to be bound to user session

#### HTTP Headers

- Origin header
- Referer header

#### SameSite Cookie Attribute

- `none`: cookie sent with all cross-origin requests
- `lax`: cookie sent with some cross-origin requests (e.g. GET form submissions, but no requests made from JavaScript).Â **This is the default in modern browsers if the attribute is not explicitly set**
- `strict`: cookie sent with no cross-origin requests
