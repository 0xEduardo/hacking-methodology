## Web Cache Poisoning - General

- Identify a way to determine keyed & unkeyed parameters
- Use Cache Buster to prevent poisoning other users
- Deliver payload in unkeyed parameter to poison the cache

Check if the server is caching requests. You can tell by looking the headers and looking for the words `HIT` OR `DYNAMIC`.

Cloudflare caches content based on MIME type only. Akamai acceppts headers

Before starting to test web cache vulnerabilities , you need to make sure that every request has a different cache key

## Cache Buster

Technique used to force the cache server to load the most recent version of a response from web server

## Vary Header

Vary header is a response header tells our that a particular header or headers from the request used to make the cache key

## Trigger Cache

- /profile.css
- /profile/nonexistent.css
- /profile?nonexistent
- /profile/x.jpeg?nonexistent
- /profile\x.jpeg?nonexistent
- /profile/.js
- /profile/;.js
- Add `\:` header

## Stored XSS

Find an endpoint that reflects content to page (cookies, parameter, headers..) and store it by poisoning the cache

## FAT Cache

Sometimes it gets cached

```
GET /path/to/place?param=content
...HEADERS...

param=content_changed
```

## Next.js

Send `x-middleware-prefetch: 1` to poison a page with empty data - CVE-2023-46298 Send `Rsc: 1`

## Path Transversal

Can I use ../ OR ..%2F OR %2E%2E%2F etc ?!

## List of cachable extensions

```
7z
csv
gif
midi
png
tif
zip
avi
doc
gz
mkv
ppt
tiff
zst
avif
docx
ico
mp3
pptx
ttf
apk
dmg
iso
mp4
ps
webm
bin
ejs
jar
ogg
rar
webp
bmp
eot
jpg
otf
svg
woff
bz2
eps
jpeg
pdf
svgz
woff2
class
exe
js
pict
swf
xls
css
flac
mid
pls
tar
xlsx
```

## Web Cache Poisoning - General

- Identify a way to determine keyed & unkeyed parameters
- Use Cache Buster to prevent poisoning other users
- Deliver payload in unkeyed parameter to poison the cache

## Web Cache Poisoning - Fat GET

- GET requests with body
- Web server may be vulnerable if it does not ignore the body
- Can be used to poison the cache even with a keyed parameter
- Example:

Code: http

```http
GET /index.php?param1=Hello&param2=World HTTP/1.1
Host: 127.0.0.1
Content-Length: 10

param3=123
```

## Web Cache Poisoning - Parameter Cloaking

- Discrepancy in the parsing of parameters between web cache and web server
- Can be used to poison the cache even with a keyed parameter
- Payload needs to be hidden in unkeyed parameter
- Example:

Code: http

```http
GET /?language=en&a=b;language=de HTTP/1.1
Host: 127.0.0.1


```

## Web Cache Poisoning Scanner

|Command|Description|
|---|---|
|`./wcvs -u http://simple.wcp.htb/`|Simple scan of a website|
|`./wcvs -u http://simple.wcp.htb/ -gr`|Generate a JSON report|

# Cool resources

|URL|
|---|
|[https://medium.com/@0xAwali/beyond-web-caching-vulnerabilities-c617d8cdbb85](https://medium.com/@0xAwali/beyond-web-caching-vulnerabilities-c617d8cdbb85)|